# Hyprland config — translated from ~/.config/sway/config
# Use Alt for WM cmds, WinKey for app launches

$mod = ALT
$execMod = SUPER
$term = wezterm
$browser = firefox
$lockCommand = hyprlock
$explorer = thunar

# ── Monitors ─────────────────────────────────────────────────────────────────
monitor = DP-2, 1920x1080@240, 0x0, 1
monitor = DP-1, 1920x1080@144, 1920x0, 1

# ── XWayland ──────────────────────────────────────────────────────────────────
xwayland {
    enabled = true
}

# ── Input ─────────────────────────────────────────────────────────────────────
input {
    kb_options = ctrl:nocaps
    follow_mouse = 1
}

# ── General ───────────────────────────────────────────────────────────────────
general {
    gaps_in = 4
    gaps_out = 8
    border_size = 2
    col.active_border = rgb(8be9fd)
    col.inactive_border = rgb(44475a)
    layout = dwindle
}

# ── Decoration ────────────────────────────────────────────────────────────────
decoration {
    rounding = 4

    blur {
        enabled = true
        size = 3
        passes = 1
    }

    shadow {
        enabled = false
    }
}

# ── Animations ────────────────────────────────────────────────────────────────
animations {
    enabled = true
    animation = windows, 1, 3, default
    animation = workspaces, 1, 4, default, slide
}

# ── Layout ────────────────────────────────────────────────────────────────────
dwindle {
    pseudotile = false
    preserve_split = true
}

# ── Workspace names ───────────────────────────────────────────────────────────
workspace = 1, name:browser
workspace = 2, name:tmux
workspace = 3, name:teams
workspace = 4, name:rdesk

# ── Autostart ─────────────────────────────────────────────────────────────────
exec-once = systemctl --user import-environment DISPLAY WAYLAND_DISPLAY HYPRLAND_INSTANCE_SIGNATURE XDG_CURRENT_DESKTOP XDG_SESSION_TYPE
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=Hyprland
exec-once = systemctl --user start xdg-desktop-portal-hyprland xdg-desktop-portal
exec-once = systemctl --user start hyprland-session.target
exec-once = hyprpaper
exec-once = hypridle
exec-once = nm-applet --indicator
exec-once = pactl set-sink-volume @DEFAULT_SINK@ 45%
exec-once = /home/appa/res/bt-volume-fix.sh
exec-once = solaar
exec-once = blueman-applet
exec-once = hyprpanel
exec-once = pasystray
exec-once = udiskie
exec-once = dex --autostart --environment Hyprland
exec-once = /home/appa/.local/bin/dictate-daemon
# --all-mime-type-regex: only persist events where ALL MIME types match (i.e. non-image).
# Rust regex has no lookahead, so we use alternation to match strings NOT starting with "image/".
# This lets wl-copy --type image/bmp (from satty-copy.sh) stay alive as clipboard owner;
# without this, wl-clip-persist immediately evicts wl-copy and re-offers, which Synergy
# can't read. Text persistence for Chrome's async clipboard release still works normally.
exec-once = wl-clip-persist --clipboard regular --all-mime-type-regex "^([^i]|i[^m]|im[^a]|ima[^g]|imag[^e]|image[^/])"
exec-once = /home/appa/res/x11-clip-sync.sh

# ── Window rules ──────────────────────────────────────────────────────────────
windowrule {
    name = firefox
    match:class = ^(firefox|org\.mozilla\.firefox)$
    workspace = 1
    border_size = 0
}

windowrule {
    name = teams
    match:class = ^chrome-cifhbcnohmdccbgoicgdjpfamggdegmo-Default$
    workspace = 3
    border_size = 0
}

windowrule {
    name = xfreerdp
    match:class = ^xfreerdp$
    workspace = 4
    border_size = 0
}

windowrule {
    name = wezterm
    match:class = ^org\.wezfurlong\.wezterm$
    border_size = 2
}

windowrule {
    name = overwatch
    match:class = ^steam_app_2357570$
    fullscreen = 1
    border_size = 0
}

# ── Keybindings ───────────────────────────────────────────────────────────────

# Terminal
bind = $mod, Return, exec, $term

# Kill focused window
bind = $mod SHIFT, Q, killactive

# App launcher
bind = $mod, D, exec, rofi -show drun

# Focus movement
bind = $mod, Left,  movefocus, l
bind = $mod, H,     movefocus, l
bind = $mod, Down,  movefocus, d
bind = $mod, J,     movefocus, d
bind = $mod, Up,    movefocus, u
bind = $mod, K,     movefocus, u
bind = $mod, Right, movefocus, r
bind = $mod, L,     movefocus, r

# Move window
bind = $mod SHIFT, Left,  movewindow, l
bind = $mod SHIFT, H,     movewindow, l
bind = $mod SHIFT, Down,  movewindow, d
bind = $mod SHIFT, J,     movewindow, d
bind = $mod SHIFT, Up,    movewindow, u
bind = $mod SHIFT, K,     movewindow, u
bind = $mod SHIFT, Right, movewindow, r
bind = $mod SHIFT, L,     movewindow, r

# Split orientation (dwindle preselect direction)
bind = $mod, backslash, layoutmsg, preselect r
bind = $mod, minus,     layoutmsg, preselect d

# Resize active window
binde = $mod CTRL, Right, resizeactive, 50 0
binde = $mod CTRL, Left,  resizeactive, -50 0
binde = $mod CTRL, Up,    resizeactive, 0 -50
binde = $mod CTRL, Down,  resizeactive, 0 50
binde = $mod CTRL, L,     resizeactive, 50 0
binde = $mod CTRL, H,     resizeactive, -50 0
binde = $mod CTRL, K,     resizeactive, 0 -50
binde = $mod CTRL, J,     resizeactive, 0 50

# Fullscreen
bind = $mod, F, fullscreen, 0

# Layout toggle (sway: stacking / tabbed / split → Hyprland has no stacking; use dwindle toggle)
bind = $mod, S, layoutmsg, togglesplit
bind = $mod, W, layoutmsg, togglesplit
bind = $mod, E, layoutmsg, togglesplit

# Toggle floating
bind = $mod SHIFT, space, togglefloating

# Focus float toggle
bind = $mod, space, togglefloating

# Focus parent (no direct equivalent; cycle through tiled)
bind = $mod, A, layoutmsg, focusmaster

# Workspace switching
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, 4, workspace, 4
bind = $mod, 5, workspace, 5
bind = $mod, 6, workspace, 6
bind = $mod, 7, workspace, 7
bind = $mod, 8, workspace, 8
bind = $mod, 9, workspace, 9
bind = $mod, 0, workspace, 10

# Move window to workspace
bind = $mod SHIFT, 1, movetoworkspace, 1
bind = $mod SHIFT, 2, movetoworkspace, 2
bind = $mod SHIFT, 3, movetoworkspace, 3
bind = $mod SHIFT, 4, movetoworkspace, 4
bind = $mod SHIFT, 5, movetoworkspace, 5
bind = $mod SHIFT, 6, movetoworkspace, 6
bind = $mod SHIFT, 7, movetoworkspace, 7
bind = $mod SHIFT, 8, movetoworkspace, 8
bind = $mod SHIFT, 9, movetoworkspace, 9
bind = $mod SHIFT, 0, movetoworkspace, 10

# Move workspace to adjacent monitor
bind = $mod CTRL, period, movecurrentworkspacetomonitor, r
bind = $mod CTRL, comma,  movecurrentworkspacetomonitor, l

# Reload / exit
bind = $mod SHIFT, C, exec, hyprctl reload
bind = $mod SHIFT, E, exec, rofi -show p -modi "p:rofi-power-menu --no-symbols" || hyprctl dispatch exit

# Resize submap
bind = $mod, R, submap, resize

submap = resize
binde = , Left,  resizeactive, -20 0
binde = , H,     resizeactive, -20 0
binde = , Down,  resizeactive, 0 20
binde = , J,     resizeactive, 0 20
binde = , Up,    resizeactive, 0 -20
binde = , K,     resizeactive, 0 -20
binde = , Right, resizeactive, 20 0
binde = , L,     resizeactive, 20 0
bind  = , Return, submap, reset
bind  = , Escape, submap, reset
bind  = $mod, R,   submap, reset
submap = reset

# Lock
bind = $mod CTRL, L, exec, $lockCommand

# App launches
bind = $execMod, B, exec, firefox
bind = $execMod, E, exec, $explorer
bind = $execMod, W, exec, ~/res/xfreerdp.sh
bind = $execMod, T, exec, dex ~/.local/share/applications/teams.desktop

# Screenshot (grimblast + satty)
# Screenshot: grimblast captures area, satty opens for annotation.
# Copy action (Ctrl+C / copy button): satty-copy.sh converts annotated PNG→BMP
#   and serves it via wl-copy --type image/bmp. Synergy reads Wayland clipboard
#   directly via wl-paste -t image/bmp. XWayland bridges to X11 for Teams.
# Save action (Ctrl+S / save button): satty writes $F, then magick+wl-copy runs.
# satty config (~/.config/satty/config.toml) sets copy-command and early-exit.
bind = $execMod, X, exec, bash -c 'F="$HOME/Pictures/Screenshots/$(date +%Y-%m-%d_%H-%M-%S).png"; grimblast save area - | satty --filename - --output-filename "$F" --copy-command /home/appa/res/satty-copy.sh --early-exit; [[ -s "$F" ]] && magick "$F" bmp:- | wl-copy --type image/bmp'

# Volume controls
bind = , XF86AudioRaiseVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ +10%
bind = , XF86AudioLowerVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ -10%
bind = , XF86AudioMute,        exec, pactl set-sink-mute @DEFAULT_SINK@ toggle
bind = , XF86AudioMicMute,     exec, pactl set-source-mute @DEFAULT_SOURCE@ toggle

# Hold-to-talk dictation (Pause = start recording, release = transcribe)
bind  = , Pause, exec, pkill -USR1 -f dictate-daemon
bindr = , Pause, exec, pkill -USR2 -f dictate-daemon

# Mouse drag floating windows with $mod
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow
